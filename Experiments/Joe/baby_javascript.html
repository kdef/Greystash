<HTML>
<HEAD>
<TITLE> Generate Password</TITLE></HEAD>
<BODY>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha256.js"></script>
<script>
<!--
//Function is called when the button is clicked.
function genPass(form)
{
	var url = getURL();
	form.url.value = url;
	
	//the local key/ certificate will be be generated when extension is 
	//installed, but for now will use hard-coded string
	var LOCAL_KEY = "db21b8a5a6e68b061c754176e6b57f220e57597c2eff9bc056ff5dec2bef407b";
	var masterPassword = form.masterPassword.value;
 
	//big long string made from the webpage url, local key, and
	//master password
	var toHash = url.concat(LOCAL_KEY, masterPassword);

	//creates a 64 digit long hex number
	var hash = CryptoJS.SHA256(toHash);
	form.password.value = hash;
	
	var hashStr = hash.toString();

	//group the hex numbers into groups of 4
	// ie a218abe4239C => [a218, abe4, 239C] 
	var hexNumbers = hashStr.match(/\w{4}/g);
	var password = [];//array of characters to use as our password
	
	//convert each hex number to an ASCII character
	for(i in hexNumbers)
	{
		var hex = hexNumbers[i];
		
		//convert hex number into an integer
		hex = parseInt(hex,16);
		
		//convert each Integer to an integer between 33 and 126
		hex = hex%94;
		hex = hex + 33;
		
		//converts integer to ASCII character
		var chr = String.fromCharCode(hex);
		password.push(chr);
	}
	password = password.join("");
	form.passwordGen.value = password;
}


//copied from http://www.codeproject.com/Tips/498368/Get-current-page-URL-using-JavaScript
function getURL()
{
	var currentPageUrl = "";
	if (typeof this.href === "undefined") 
	{
		currentPageUrl = document.location.toString().toLowerCase();
	}
	else 
	{
		currentPageUrl = this.href.toString().toLowerCase();
	}
	return currentPageUrl
}


</SCRIPT>
<form>
	<p>Master Password:<input type="password" name="masterPassword"></p>
	<p><input type="button" value="Get Password" onClick="genPass(this.form)"></p>
	<p>Webpage URL:      <input type="text" name="url" size="50"></p>
	<p>Hex Number:<input type="text" name="password" size="75"></p>
	<p>Password Generated:<input type="text" name="passwordGen"></p>
</form>
</body></html>
</BODY>
</HTML>